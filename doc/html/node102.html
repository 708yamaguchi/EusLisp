<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML 2.0//EN">
<!--Converted with LaTeX2HTML 96.1 (Feb 5, 1996) by Nikos Drakos (nikos@cbl.leeds.ac.uk), CBLU, University of Leeds -->
<HTML>
<HEAD>
<TITLE>Synchronization</TITLE>
<META NAME="description" CONTENT="Synchronization">
<META NAME="keywords" CONTENT="manual">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">
<LINK REL=STYLESHEET HREF="manual.css">
</HEAD>
<BODY LANG="EN">
 <A NAME="tex2html3275" HREF="node103.html"><IMG WIDTH=37 HEIGHT=24 ALIGN=BOTTOM ALT="next" SRC="./icons/next_motif.gif"></A> <A NAME="tex2html3273" HREF="node88.html"><IMG WIDTH=26 HEIGHT=24 ALIGN=BOTTOM ALT="up" SRC="./icons/up_motif.gif"></A> <A NAME="tex2html3269" HREF="node101.html"><IMG WIDTH=63 HEIGHT=24 ALIGN=BOTTOM ALT="previous" SRC="./icons/previous_motif.gif"></A> <A NAME="tex2html3277" HREF="node1.html"><IMG WIDTH=65 HEIGHT=24 ALIGN=BOTTOM ALT="contents" SRC="./icons/contents_motif.gif"></A> <A NAME="tex2html3278" HREF="node153.html"><IMG WIDTH=43 HEIGHT=24 ALIGN=BOTTOM ALT="index" SRC="./icons/index_motif.gif"></A> <BR>
<B> Next:</B> <A NAME="tex2html3276" HREF="node103.html">Geometric Functions</A>
<B>Up:</B> <A NAME="tex2html3274" HREF="node88.html">Multithread</A>
<B> Previous:</B> <A NAME="tex2html3270" HREF="node101.html">Thread creation</A>
<BR> <P>
<H2><A NAME="SECTION04025000000000000000">Synchronization</A></H2>
<P>
Among Solaris operating systems four synchronization primitives for
multithread programs, EusLisp provides mutex locks, conditional variables,
and semaphores. Reader-writer lock is not available now.
<P>
Based on these primitives, higher level synchronization mechanisms,
such as synchronized memory port and barrier synchronization, are realized.
<P>
<A NAME=13036>&#160;</A>
<B>sys:make-mutex-lock</B> <EM></EM>[function] 
<UL><LI> makes a mutex-lock and returns it. A mutex-lock is represented by an
integer-vector of six elements.
</UL>
<A NAME=13046>&#160;</A>
<B>sys:mutex-lock</B> <EM>mlock </EM>[function] 
<UL><LI> locks the mutex lock <EM>mlock.
If the <EM>mlock is already locked by another thread,
<EM>mutex-lock</EM> waits for the lock to be released.
</UL>
<A NAME=13059>&#160;</A>
<B>sys:mutex-unlock</B> <EM>mlock </EM>[function] 
<UL><LI> releases <EM>mlock and let one of other threads waiting for this
lock resume running.
</UL>
<A NAME=13070>&#160;</A>
<B>sys:mutex</B> <EM>mlock &amp;rest forms </EM>[macro] 
<UL><LI> Mutex-lock and mutex-unlock have to be used as a pair.
<B>Mutex</B> is a macro that brackets a critical section.
<EM>Mlock is locked
before evaluating <EM>forms</EM> are evaluated,
and the lock is released when the evaluation finishes.
This macro expands to the following progn form.
Note that <B>unwind-protect</B> is used to ensure unlocking
even an error occurs during the evaluation of <EM>forms</EM>.
<P>
</UL>
<BLOCKQUOTE> <PRE>  (progn
      (sys:mutex-lock mlock)
      (unwind-protect
          (progn . forms)
          (sys:mutex-unlock mlock)))</PRE>
</BLOCKQUOTE>
<P>
<A NAME=13085>&#160;</A>
<B>sys:make-cond</B> <EM></EM>[function] 
<UL><LI> makes a condition variable object
which is an integer vector of four elements.
The returned condition variable is in unlocked state.
</UL>
<A NAME=13095>&#160;</A>
<B>sys:cond-wait</B> <EM>condvar mlock </EM>[function] 
<UL><LI> waits for <EM>condvar to be signaled.
If <EM>condvar has already been acquired by another thread,
it releases <EM>mlock</EM> and waits for <EM>condvar</EM> to be signaled.
</UL>
<A NAME=13109>&#160;</A>
<B>sys:cond-signal</B> <EM>condvar </EM>[function] 
<UL><LI> signals the <EM>condvar condition variable.
</UL>
<A NAME=13120>&#160;</A>
<B>sys:make-semaphore</B> <EM></EM>[function] 
<UL><LI> makes a semaphore object
which is represented by an integer vector of twelve elements.
</UL>
<A NAME=13130>&#160;</A>
<B>sys:sema-post</B> <EM>sem </EM>[function] 
<UL><LI> signals <EM>sem.
</UL>
<A NAME=13141>&#160;</A>
<B>sys:sema-wait</B> <EM>sem </EM>[function] 
<UL><LI> waits for the <EM>sem semaphore to be posted.
</UL>
<A NAME=13153>&#160;</A>
<B>sys:barrier-synch </B> [class]  <PRE><TT> :super B<>propertied-object</B>
<P>
:slots 		 
threads n-threads count barrier-cond threads-lock count-lock
<P>
</TT></PRE>
<UL><LI> represents a structure for barrier-synchronization. Threads waiting
for the synchronization are put in <EM>threads which is mutually excluded
by <EM>threads-lock</EM>.
When a <B>barrier-synch</B> object is created,
<EM>count</EM> is initialized to zero.
Synchronizing threads are put in the <EM>threads</EM> list by sending <TT>:add</TT>
message.
Sending <TT>:wait</TT> to this barrier-sync object causes <EM>count</EM> to be
incremented, and the sending thread is put in the wait state.
When all the threads in <EM>threads</EM> send the <TT>:wait</TT> message,
the waits are unblocked and all threads resume execution.
The synchronization is implemented by the combination of
the <EM>count-lock</EM> mutex-lock and the <EM>barrier-cond</EM>
condition-variable.
</UL>
<A NAME=13182>&#160;</A>
<B>:init</B> <EM></EM>[method] 
<UL><LI> initializes this barrier-synch object. Two mutex-lock
and one condition-variable are created.
</UL>
<A NAME=13192>&#160;</A>
<B>:add</B> <EM>thr </EM>[method] 
<UL><LI> adds the <EM>thr thread in the <EM>threads list.
</UL>
<A NAME=13204>&#160;</A>
<B>:remove</B> <EM>thr </EM>[method] 
<UL><LI> removes the <EM>thr thread of the <EM>threads</EM> list.
</UL>
<A NAME=13216>&#160;</A>
<B>:wait</B> <EM></EM>[method] 
<UL><LI> waits for all threads in the <EM>threads list
to issue <TT>:wait</TT>.
</UL>
<A NAME=13229>&#160;</A>
<B>sys:synch-memory-port </B> [class]  <PRE><TT> :super B<>propertied-object</B>
<P>
:slots 		 
sema-in sema-out buf empty lock
<P>
</TT></PRE>
<UL><LI> 
realizes the one-directional synchronized memory port,
which synchronizes for two threads
to transfer datum via this object.
Control transfer is implemented by using semaphores.
</UL>
<A NAME=13246>&#160;</A>
<B>:read</B> <EM></EM>[method] 
<UL><LI> reads datum buffered in this synch-memory-port.
If it has not been written yet, the :read blocks.
</UL>
<A NAME=13256>&#160;</A>
<B>:write</B> <EM>datum </EM>[method] 
<UL><LI> writes <EM>datum in the buffer.
Since only one word of buffer is available,
if another datum has already been written and not yet read out,
:write waits for the datum to be transferred by :read.
</UL>
<A NAME=13267>&#160;</A>
<B>:init</B> <EM></EM>[method] 
<UL><LI> initializes this synch-memory-port
where two semaphores  are created and :write is made acceptable.
</UL>
<P>
</EM></EM></EM></EM></EM></EM></EM></EM></EM></EM></EM></EM></EM></EM></EM><HR><A NAME="tex2html3275" HREF="node103.html"><IMG WIDTH=37 HEIGHT=24 ALIGN=BOTTOM ALT="next" SRC="./icons/next_motif.gif"></A> <A NAME="tex2html3273" HREF="node88.html"><IMG WIDTH=26 HEIGHT=24 ALIGN=BOTTOM ALT="up" SRC="./icons/up_motif.gif"></A> <A NAME="tex2html3269" HREF="node101.html"><IMG WIDTH=63 HEIGHT=24 ALIGN=BOTTOM ALT="previous" SRC="./icons/previous_motif.gif"></A> <A NAME="tex2html3277" HREF="node1.html"><IMG WIDTH=65 HEIGHT=24 ALIGN=BOTTOM ALT="contents" SRC="./icons/contents_motif.gif"></A> <A NAME="tex2html3278" HREF="node153.html"><IMG WIDTH=43 HEIGHT=24 ALIGN=BOTTOM ALT="index" SRC="./icons/index_motif.gif"></A> <BR>
<B> Next:</B> <A NAME="tex2html3276" HREF="node103.html">Geometric Functions</A>
<B>Up:</B> <A NAME="tex2html3274" HREF="node88.html">Multithread</A>
<B> Previous:</B> <A NAME="tex2html3270" HREF="node101.html">Thread creation</A>
<P><ADDRESS>
<I>Hirofumi Nakagaki <BR>
Tue Mar 19 19:45:39 JST 1996</I>
</ADDRESS>
</BODY>
</HTML>
